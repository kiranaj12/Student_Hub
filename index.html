<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Student-Hub - AI-Powered Student Management</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="description" content="AI-powered student details management system">
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for AI Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #ec4899 100%);
        }
        .glass-effect {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .ai-glow {
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        }
        .install-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Mobile-specific fixes */
        @media (max-width: 768px) {
            input, select, textarea, button {
                font-size: 16px !important; /* Prevent zoom on iOS */
                -webkit-appearance: none;
                border-radius: 8px;
            }
            
            button {
                min-height: 44px; /* iOS touch target size */
                touch-action: manipulation;
            }
            
            .glass-effect {
                backdrop-filter: blur(10px);
            }
            
            /* Fix for mobile form inputs */
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: #4F46E5;
                box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- PWA Install Banner -->
    <div id="installBanner" class="fixed top-0 left-0 right-0 z-50 bg-indigo-600 text-white p-4 text-center install-pulse" style="display: none;">
        <div class="flex items-center justify-center space-x-4">
            <i class="fas fa-mobile-alt text-xl"></i>
            <span class="font-semibold">Install Student-Hub on your device for the best experience!</span>
            <button id="installBtn" class="bg-white text-indigo-600 px-4 py-2 rounded-lg font-bold hover:bg-gray-100 transition-colors">
                <i class="fas fa-download mr-2"></i>Install App
            </button>
            <button id="dismissInstall" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Enhanced Mobile Install Popup -->
    <div id="installPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
            <div class="mb-6">
                <div class="w-20 h-20 bg-indigo-600 rounded-2xl mx-auto mb-4 flex items-center justify-center animate-pulse">
                    <i class="fas fa-graduation-cap text-3xl text-white"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Install Student-Hub</h3>
                <p class="text-gray-600">Get the full app experience on your device</p>
            </div>
            
            <div class="space-y-3 mb-6 text-left">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span class="text-gray-700">Work offline</span>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span class="text-gray-700">Fast loading</span>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span class="text-gray-700">Home screen access</span>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span class="text-gray-700">Push notifications</span>
                </div>
            </div>
            
            <div class="space-y-3">
                <button id="installPopupBtn" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-bold hover:bg-indigo-700 transition-colors transform hover:scale-105">
                    <i class="fas fa-download mr-2"></i>Install Now
                </button>
                <button id="dismissPopup" class="w-full text-gray-500 hover:text-gray-700 transition-colors">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Install Button -->
    <div id="floatingInstall" class="fixed bottom-4 right-4 z-40" style="display: none;">
        <button onclick="handleInstall()" class="bg-indigo-600 text-white p-4 rounded-full shadow-lg hover:bg-indigo-700 transition-colors install-pulse">
            <i class="fas fa-download text-xl"></i>
        </button>
    </div>

    <!-- Authentication Section -->
    <div id="authSection" class="container mx-auto px-4 py-8">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="text-center mb-8">
            <div class="glass-effect rounded-2xl p-8 ai-glow max-w-md mx-auto">
                <h1 class="text-3xl font-bold text-white mb-2">
                    <i class="fas fa-graduation-cap mr-3"></i>Student-Hub
                </h1>
                <p class="text-gray-200 text-lg font-semibold mb-2">SREE SIDDRAMESHWARA POLYTECHNIC TIPTUR</p>
                <p class="text-gray-300 text-sm mb-6">Diploma Student Management System</p>
                <div class="space-y-4">
                    <button onclick="showAuthForm('signin')" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
                        <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                    </button>
                    <button onclick="showAuthForm('signup')" class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:from-green-700 hover:to-teal-700 transition-all">
                        <i class="fas fa-user-plus mr-2"></i>Register
                    </button>
                </div>
            </div>
        </div>

        <!-- Sign In Form -->
        <div id="signinForm" class="glass-effect rounded-xl p-8 max-w-md mx-auto" style="display: none;">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">
                <i class="fas fa-sign-in-alt mr-2"></i>Sign In
            </h2>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-white font-semibold mb-2">Username *</label>
                    <input type="text" id="loginId" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none" placeholder="Enter your username">
                </div>

                <div>
                    <label class="block text-white font-semibold mb-2">Password *</label>
                    <input type="password" id="loginPassword" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none" placeholder="Enter your password">
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
                    <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                </button>
            </form>

            <div class="text-center mt-6">
                <button onclick="showAuthForm('signup')" class="text-blue-300 hover:text-blue-200 underline">
                    Don't have an account? Register here
                </button>
                <br>
                <button onclick="showAuthForm('welcome')" class="text-gray-300 hover:text-gray-200 underline mt-2">
                    Back to Welcome
                </button>
            </div>
            
            <!-- Demo Credentials -->
            <div class="mt-6 p-4 bg-blue-600/20 rounded-lg border border-blue-400/30">
                <h4 class="text-blue-300 font-semibold mb-2">Demo Credentials:</h4>
                <p class="text-blue-200 text-sm">Admin: <strong>admin</strong> / <strong>admin123</strong></p>
                <p class="text-blue-200 text-sm">Student: <strong>rahul_kumar</strong> / <strong>student123</strong></p>
                <button onclick="clearAllData()" class="mt-2 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                    Clear All Data (Debug)
                </button>
            </div>
        </div>

        <!-- Sign Up Form -->
        <div id="signupForm" class="glass-effect rounded-xl p-8 max-w-2xl mx-auto" style="display: none;">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">
                <i class="fas fa-user-plus mr-2"></i>Register New Account
            </h2>
            
            <form id="registerForm" class="space-y-6">
                <div>
                    <label class="block text-white font-semibold mb-2">Account Type *</label>
                    <select id="accountType" required class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:border-blue-400 focus:outline-none" onchange="toggleAccountFields()">
                        <option value="">Select Account Type</option>
                        <option value="student">Student</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white font-semibold mb-2">Full Name *</label>
                        <input type="text" id="regFullName" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Username *</label>
                        <input type="text" id="regNumber" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none" placeholder="e.g., john_doe">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white font-semibold mb-2">Email *</label>
                        <input type="email" id="regEmail" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Phone Number</label>
                        <input type="tel" id="regPhone" class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none">
                    </div>
                </div>

                <div id="studentFields" class="space-y-4" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Department *</label>
                            <select id="regDepartment" class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Department</option>
                                <option value="CSE">Computer Science and Engineering</option>
                                <option value="EC">Electronics and Communication</option>
                                <option value="ME">Mechanical Engineering</option>
                                <option value="CE">Civil Engineering</option>
                                <option value="EE">Electrical Engineering</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Year *</label>
                            <select id="regYear" class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Year</option>
                                <option value="1">1st Year</option>
                                <option value="2">2nd Year</option>
                                <option value="3">3rd Year</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Semester *</label>
                            <select id="regSemester" class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Semester</option>
                                <option value="1">1st Semester</option>
                                <option value="2">2nd Semester</option>
                                <option value="3">3rd Semester</option>
                                <option value="4">4th Semester</option>
                                <option value="5">5th Semester</option>
                                <option value="6">6th Semester</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="adminFields" class="space-y-4" style="display: none;">
                    <div>
                        <label class="block text-white font-semibold mb-2">Role Type *</label>
                        <select id="regRole" class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:border-blue-400 focus:outline-none">
                            <option value="">Select Role</option>
                            <option value="Teacher">Teacher</option>
                            <option value="HOD">Head of Department (HOD)</option>
                            <option value="Dean">Dean</option>
                            <option value="Principal">Principal</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white font-semibold mb-2">Password *</label>
                        <input type="password" id="regPassword" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none" minlength="6">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Confirm Password *</label>
                        <input type="password" id="regConfirmPassword" required class="w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 border border-gray-300 focus:border-blue-400 focus:outline-none" minlength="6">
                    </div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:from-green-700 hover:to-teal-700 transition-all">
                    <i class="fas fa-user-plus mr-2"></i>Create Account
                </button>
            </form>

            <div class="text-center mt-6">
                <button onclick="showAuthForm('signin')" class="text-blue-300 hover:text-blue-200 underline">
                    Already have an account? Sign in here
                </button>
                <br>
                <button onclick="showAuthForm('welcome')" class="text-gray-300 hover:text-gray-200 underline mt-2">
                    Back to Welcome
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="container mx-auto px-4 py-8" style="display: none;">
        <!-- Header -->
        <header class="text-center mb-8 slide-in">
            <div class="glass-effect rounded-2xl p-6 ai-glow">
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <h1 class="text-4xl font-bold text-white mb-2">
                            <i class="fas fa-graduation-cap mr-3"></i>Student-Hub
                        </h1>
                        <p class="text-gray-200 text-lg">SREE SIDDRAMESHWARA POLYTECHNIC TIPTUR</p>
                        <p class="text-gray-300 text-sm">Diploma Student Management System</p>
                    </div>
                    <div class="text-right">
                        <p class="text-white font-semibold" id="userWelcome">Welcome!</p>
                        <p class="text-gray-300 text-sm" id="userRole"></p>
                        <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors mt-2">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="mb-8">
            <div class="glass-effect rounded-xl p-4">
                <div id="adminNav" class="flex flex-wrap justify-center space-x-2 space-y-2">
                    <button onclick="showSection('dashboard')" class="nav-btn bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer">
                        <i class="fas fa-chart-line mr-2"></i>Dashboard
                    </button>
                    <button onclick="showSection('addStudent')" class="nav-btn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors cursor-pointer">
                        <i class="fas fa-user-plus mr-2"></i>Add Student
                    </button>
                    <button onclick="showSection('viewStudents')" class="nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer">
                        <i class="fas fa-users mr-2"></i>View Students
                    </button>
                    <button onclick="showSection('analytics')" class="nav-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors cursor-pointer">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                    <button onclick="showSection('reports')" class="nav-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors cursor-pointer">
                        <i class="fas fa-file-alt mr-2"></i>Reports
                    </button>
                    <button onclick="showSection('attendanceManagement')" class="nav-btn bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors cursor-pointer">
                        <i class="fas fa-calendar-check mr-2"></i>Attendance Management
                    </button>
                    <button onclick="showSection('settings')" class="nav-btn bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
                <div id="studentNav" class="flex flex-wrap justify-center space-x-2 space-y-2" style="display: none;">
                    <button onclick="showSection('studentDashboard')" class="nav-btn bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer">
                        <i class="fas fa-chart-line mr-2"></i>My Dashboard
                    </button>
                    <button onclick="showSection('profile')" class="nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer">
                        <i class="fas fa-user mr-2"></i>Profile
                    </button>
                    <button onclick="showSection('grades')" class="nav-btn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors cursor-pointer">
                        <i class="fas fa-graduation-cap mr-2"></i>Grades
                    </button>
                    <button onclick="showSection('attendance')" class="nav-btn bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors cursor-pointer">
                        <i class="fas fa-calendar-check mr-2"></i>My Attendance
                    </button>
                    <button onclick="showSection('submitAttendance')" class="nav-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors cursor-pointer">
                        <i class="fas fa-plus-circle mr-2"></i>Submit Attendance
                    </button>
                    <button onclick="showSection('assignments')" class="nav-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors cursor-pointer">
                        <i class="fas fa-tasks mr-2"></i>Assignments
                    </button>
                    <button onclick="showSection('notifications')" class="nav-btn bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors cursor-pointer">
                        <i class="fas fa-bell mr-2"></i>Notifications
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-effect rounded-xl p-6 text-white text-center">
                    <i class="fas fa-users text-3xl mb-3 text-blue-300"></i>
                    <h3 class="text-2xl font-bold" id="totalStudents">0</h3>
                    <p class="text-gray-300">Total Students</p>
                </div>
                <div class="glass-effect rounded-xl p-6 text-white text-center">
                    <i class="fas fa-chart-line text-3xl mb-3 text-green-300"></i>
                    <h3 class="text-2xl font-bold" id="avgGrade">0</h3>
                    <p class="text-gray-300">Average Grade</p>
                </div>
                <div class="glass-effect rounded-xl p-6 text-white text-center">
                    <i class="fas fa-trophy text-3xl mb-3 text-yellow-300"></i>
                    <h3 class="text-2xl font-bold" id="topPerformers">0</h3>
                    <p class="text-gray-300">Top Performers</p>
                </div>
                <div class="glass-effect rounded-xl p-6 text-white text-center">
                    <i class="fas fa-robot text-3xl mb-3 text-purple-300"></i>
                    <h3 class="text-2xl font-bold">AI</h3>
                    <p class="text-gray-300">Predictions Ready</p>
                </div>
            </div>

            <!-- AI Analytics Dashboard -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-chart-bar mr-2"></i>Department Performance
                    </h3>
                    <canvas id="departmentChart" width="400" height="200"></canvas>
                </div>
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-chart-pie mr-2"></i>Grade Distribution
                    </h3>
                    <canvas id="gradeChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4">
                    <i class="fas fa-clock mr-2"></i>Recent Activities
                </h3>
                <div id="recentActivities" class="space-y-3">
                    <!-- Activities will be populated here -->
                </div>
            </div>
        </section>

        <!-- Add Student Section -->
        <section id="addStudent" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-8 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-user-plus mr-2"></i>Add New Student
                </h2>
                
                <form id="studentForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Full Name *</label>
                            <input type="text" id="fullName" required class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Student ID *</label>
                            <input type="text" id="studentId" required class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Email *</label>
                            <input type="email" id="email" required class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Phone</label>
                            <input type="tel" id="phone" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Department *</label>
                            <select id="department" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Department</option>
                                <option value="CSE">Computer Science and Engineering</option>
                                <option value="EC">Electronics and Communication</option>
                                <option value="ME">Mechanical Engineering</option>
                                <option value="CE">Civil Engineering</option>
                                <option value="EE">Electrical Engineering</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Year *</label>
                            <select id="year" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Year</option>
                                <option value="1">1st Year</option>
                                <option value="2">2nd Year</option>
                                <option value="3">3rd Year</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Semester</label>
                            <select id="semester" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Semester</option>
                                <option value="1">1st Semester</option>
                                <option value="2">2nd Semester</option>
                                <option value="3">3rd Semester</option>
                                <option value="4">4th Semester</option>
                                <option value="5">5th Semester</option>
                                <option value="6">6th Semester</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all ai-glow">
                        <i class="fas fa-plus mr-2"></i>Add Student
                    </button>
                </form>
            </div>
        </section>

        <!-- View Students Section -->
        <section id="viewStudents" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-users mr-2"></i>Student Records
                </h2>

                <div class="overflow-x-auto">
                    <table class="w-full text-white">
                        <thead>
                            <tr class="border-b border-white/30">
                                <th class="text-left p-3">Name</th>
                                <th class="text-left p-3">ID</th>
                                <th class="text-left p-3">Department</th>
                                <th class="text-left p-3">Year</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- Students will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Student Dashboard -->
        <section id="studentDashboard" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6 mb-6 text-center">
                <h2 class="text-3xl font-bold mb-2" id="dashboardWelcome">Welcome Back!</h2>
                <p class="text-lg" id="dashboardStudentInfo">Loading your academic overview...</p>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6 mb-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-chart-bar mr-2"></i>Advanced Analytics
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Performance Trends</h3>
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Attendance Analysis</h3>
                        <canvas id="attendanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">AI Predictions</h3>
                    <div id="aiPredictions" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- AI predictions will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-file-alt mr-2"></i>Generate Reports
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-users text-3xl mb-3 text-blue-300"></i>
                        <h3 class="text-lg font-bold text-white mb-2">Student Report</h3>
                        <button onclick="generateReport('student')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Generate
                        </button>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-chart-line text-3xl mb-3 text-green-300"></i>
                        <h3 class="text-lg font-bold text-white mb-2">Performance Report</h3>
                        <button onclick="generateReport('performance')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            Generate
                        </button>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-calendar-check text-3xl mb-3 text-yellow-300"></i>
                        <h3 class="text-lg font-bold text-white mb-2">Attendance Report</h3>
                        <button onclick="generateReport('attendance')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                            Generate
                        </button>
                    </div>
                </div>
                
                <div id="reportOutput" class="glass-effect rounded-xl p-6" style="display: none;">
                    <h3 class="text-xl font-bold text-white mb-4">Report Output</h3>
                    <div id="reportContent" class="text-white">
                        <!-- Report content will be displayed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Attendance Management Section (Admin) -->
        <section id="attendanceManagement" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6 mb-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-calendar-check mr-2"></i>Attendance Management
                </h2>
                
                <!-- Filter Controls -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div>
                        <label class="block text-white font-semibold mb-2">Filter by Status</label>
                        <select id="attendanceStatusFilter" onchange="filterAttendanceRequests()" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            <option value="all">All Requests</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Filter by Department</label>
                        <select id="attendanceDeptFilter" onchange="filterAttendanceRequests()" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            <option value="all">All Departments</option>
                            <option value="CSE">CSE</option>
                            <option value="EC">EC</option>
                            <option value="ME">ME</option>
                            <option value="CE">CE</option>
                            <option value="EE">EE</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">From Date</label>
                        <input type="date" id="attendanceFromDate" onchange="filterAttendanceRequests()" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">To Date</label>
                        <input type="date" id="attendanceToDate" onchange="filterAttendanceRequests()" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-clock text-3xl mb-3 text-yellow-300"></i>
                        <h3 class="text-2xl font-bold text-white" id="pendingRequests">0</h3>
                        <p class="text-gray-300">Pending Requests</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-check-circle text-3xl mb-3 text-green-300"></i>
                        <h3 class="text-2xl font-bold text-white" id="approvedRequests">0</h3>
                        <p class="text-gray-300">Approved Today</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-times-circle text-3xl mb-3 text-red-300"></i>
                        <h3 class="text-2xl font-bold text-white" id="rejectedRequests">0</h3>
                        <p class="text-gray-300">Rejected Today</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-calendar-day text-3xl mb-3 text-blue-300"></i>
                        <h3 class="text-2xl font-bold text-white" id="totalRequests">0</h3>
                        <p class="text-gray-300">Total Requests</p>
                    </div>
                </div>

                <!-- Attendance Requests Table -->
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">Attendance Requests</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/30">
                                    <th class="text-left p-3">Student</th>
                                    <th class="text-left p-3">Department</th>
                                    <th class="text-left p-3">Date</th>
                                    <th class="text-left p-3">Subject</th>
                                    <th class="text-left p-3">Reason</th>
                                    <th class="text-left p-3">Status</th>
                                    <th class="text-left p-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceRequestsTable">
                                <!-- Attendance requests will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Submit Attendance Section (Student) -->
        <section id="submitAttendance" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-8 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-plus-circle mr-2"></i>Submit Attendance Request
                </h2>
                
                <form id="attendanceForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Date *</label>
                            <input type="date" id="attendanceDate" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Subject *</label>
                            <select id="attendanceSubject" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Subject</option>
                                <option value="Data Structures">Data Structures</option>
                                <option value="Computer Networks">Computer Networks</option>
                                <option value="Database Systems">Database Systems</option>
                                <option value="Software Engineering">Software Engineering</option>
                                <option value="Web Technologies">Web Technologies</option>
                                <option value="Operating Systems">Operating Systems</option>
                                <option value="Computer Graphics">Computer Graphics</option>
                                <option value="Artificial Intelligence">Artificial Intelligence</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-semibold mb-2">Session Type *</label>
                            <select id="sessionType" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Session</option>
                                <option value="Theory">Theory Class</option>
                                <option value="Practical">Practical/Lab</option>
                                <option value="Tutorial">Tutorial</option>
                                <option value="Seminar">Seminar</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-2">Time Slot *</label>
                            <select id="timeSlot" required class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
                                <option value="">Select Time</option>
                                <option value="09:00-10:00">09:00 - 10:00 AM</option>
                                <option value="10:00-11:00">10:00 - 11:00 AM</option>
                                <option value="11:00-12:00">11:00 - 12:00 PM</option>
                                <option value="12:00-13:00">12:00 - 01:00 PM</option>
                                <option value="14:00-15:00">02:00 - 03:00 PM</option>
                                <option value="15:00-16:00">03:00 - 04:00 PM</option>
                                <option value="16:00-17:00">04:00 - 05:00 PM</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-white font-semibold mb-2">Reason for Late Submission</label>
                        <textarea id="attendanceReason" rows="4" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Please explain why you're submitting this attendance request (e.g., forgot to mark, technical issues, etc.)"></textarea>
                    </div>

                    <div class="bg-blue-600/20 rounded-lg p-4 border border-blue-400/30">
                        <h4 class="text-blue-300 font-semibold mb-2">
                            <i class="fas fa-info-circle mr-2"></i>Important Notes:
                        </h4>
                        <ul class="text-blue-200 text-sm space-y-1">
                            <li>• You can only submit attendance for past 7 days</li>
                            <li>• All requests require admin approval</li>
                            <li>• Provide a valid reason for late submission</li>
                            <li>• False attendance requests may result in disciplinary action</li>
                        </ul>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all ai-glow">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Attendance Request
                    </button>
                </form>

                <!-- My Attendance Requests -->
                <div class="mt-8 glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-list mr-2"></i>My Recent Requests
                    </h3>
                    <div id="myAttendanceRequests" class="space-y-3">
                        <!-- Student's attendance requests will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-cog mr-2"></i>System Settings
                </h2>
                
                <div class="space-y-6">
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4">General Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-white font-semibold mb-2">Institution Name</label>
                                <input type="text" value="SREE SIDDRAMESHWARA POLYTECHNIC TIPTUR" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            </div>
                            <div>
                                <label class="block text-white font-semibold mb-2">Academic Year</label>
                                <select class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                                    <option value="2023-24">2023-24</option>
                                    <option value="2024-25">2024-25</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4">Notification Settings</h3>
                        <div class="space-y-3">
                            <label class="flex items-center text-white">
                                <input type="checkbox" checked class="mr-3">
                                Email notifications for new students
                            </label>
                            <label class="flex items-center text-white">
                                <input type="checkbox" checked class="mr-3">
                                SMS alerts for attendance
                            </label>
                            <label class="flex items-center text-white">
                                <input type="checkbox" class="mr-3">
                                Weekly performance reports
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Student Grades Section -->
        <section id="grades" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-graduation-cap mr-2"></i>My Grades
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Current GPA</h3>
                        <div class="text-4xl font-bold text-green-300" id="studentGPA">3.8</div>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Class Rank</h3>
                        <div class="text-4xl font-bold text-blue-300" id="studentRank">5</div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">Subject Grades</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/30">
                                    <th class="text-left p-3">Subject</th>
                                    <th class="text-left p-3">Credits</th>
                                    <th class="text-left p-3">Grade</th>
                                    <th class="text-left p-3">Points</th>
                                </tr>
                            </thead>
                            <tbody id="gradesTable">
                                <!-- Grades will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Student Attendance Section -->
        <section id="attendance" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-calendar-check mr-2"></i>My Attendance
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Overall Attendance</h3>
                        <div class="text-4xl font-bold text-green-300" id="overallAttendance">85%</div>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Present Days</h3>
                        <div class="text-4xl font-bold text-blue-300" id="presentDays">170</div>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Absent Days</h3>
                        <div class="text-4xl font-bold text-red-300" id="absentDays">30</div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">Subject-wise Attendance</h3>
                    <div id="attendanceChart2" class="mb-4">
                        <canvas id="subjectAttendanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Student Assignments Section -->
        <section id="assignments" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-tasks mr-2"></i>My Assignments
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Pending</h3>
                        <div class="text-4xl font-bold text-yellow-300" id="pendingAssignments">3</div>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Completed</h3>
                        <div class="text-4xl font-bold text-green-300" id="completedAssignments">12</div>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <h3 class="text-lg font-bold text-white mb-2">Overdue</h3>
                        <div class="text-4xl font-bold text-red-300" id="overdueAssignments">1</div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">Assignment List</h3>
                    <div id="assignmentsList" class="space-y-4">
                        <!-- Assignments will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Student Notifications Section -->
        <section id="notifications" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-bell mr-2"></i>Notifications
                </h2>
                
                <div class="space-y-4" id="notificationsList">
                    <!-- Notifications will be populated here -->
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section" style="display: none;">
            <div class="glass-effect rounded-xl p-8 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-user mr-2"></i>My Profile
                </h2>
                
                <div id="studentProfile" class="space-y-6">
                    <!-- Student profile will be populated here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-20 right-4 z-40"></div>

    <script>
        // Global Variables
        let students = [];
        let users = [];
        let attendanceRequests = [];
        let currentUser = null;
        let currentSection = 'dashboard';
        let deferredPrompt;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Student-Hub initializing...');
            
            // Initialize sample data
            initializeSampleData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize PWA features
            initializePWA();
            
            // Check if user is already logged in
            loadCurrentUser();
            
            // Add mobile-specific event handlers
            setupMobileEventHandlers();
        });

        // Mobile-specific event handlers
        function setupMobileEventHandlers() {
            console.log('Setting up mobile event handlers...');
            
            // Add touch event support for buttons
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Prevent zoom on double tap for form inputs
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Add specific handlers for auth buttons
            setTimeout(() => {
                // Sign in button handlers
                const signinButtons = document.querySelectorAll('button[onclick*="signin"]');
                signinButtons.forEach(btn => {
                    btn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        showAuthForm('signin');
                    });
                });
                
                // Sign up button handlers
                const signupButtons = document.querySelectorAll('button[onclick*="signup"]');
                signupButtons.forEach(btn => {
                    btn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        showAuthForm('signup');
                    });
                });
                
                // Form submission button handlers
                const loginSubmitBtn = document.querySelector('#loginForm button[type="submit"]');
                if (loginSubmitBtn) {
                    loginSubmitBtn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        setTimeout(() => handleLogin(), 100);
                    });
                }
                
                const registerSubmitBtn = document.querySelector('#registerForm button[type="submit"]');
                if (registerSubmitBtn) {
                    registerSubmitBtn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        setTimeout(() => handleRegister(), 100);
                    });
                }
            }, 500);
        }

        // Initialize sample data
        function initializeSampleData() {
            // Load from localStorage or create sample data
            const savedUsers = localStorage.getItem('users');
            const savedStudents = localStorage.getItem('students');
            const savedAttendanceRequests = localStorage.getItem('attendanceRequests');
            
            if (savedUsers) {
                users = JSON.parse(savedUsers);
                console.log('Loaded existing users:', users.length);
            } else {
                // Create sample admin and student
                users = [{
                    id: 1,
                    accountType: 'admin',
                    fullName: 'System Administrator',
                    username: 'admin',
                    email: 'admin@sspt.edu.in',
                    phone: '555-0000',
                    role: 'Principal',
                    password: 'admin123',
                    dateCreated: new Date().toISOString()
                }, {
                    id: 2,
                    accountType: 'student',
                    fullName: 'Rahul Kumar',
                    username: 'rahul_kumar',
                    email: 'rahul@sspt.edu.in',
                    phone: '9876543210',
                    department: 'CSE',
                    year: '2',
                    semester: '3',
                    password: 'student123',
                    dateCreated: new Date().toISOString()
                }];
                localStorage.setItem('users', JSON.stringify(users));
                console.log('Created sample users:', users.length);
            }
            
            if (savedStudents) {
                students = JSON.parse(savedStudents);
            } else {
                // Create sample students
                students = [{
                    id: 2,
                    fullName: "Rahul Kumar",
                    studentId: "485CS23054",
                    username: "rahul_kumar",
                    email: "rahul@sspt.edu.in",
                    phone: "9876543210",
                    department: "CSE",
                    year: "2",
                    semester: "3",
                    gpa: 3.8,
                    dateAdded: new Date().toISOString()
                }];
                localStorage.setItem('students', JSON.stringify(students));
            }

            if (savedAttendanceRequests) {
                attendanceRequests = JSON.parse(savedAttendanceRequests);
            } else {
                // Create sample attendance requests
                attendanceRequests = [
                    {
                        id: 1,
                        studentId: 2,
                        studentName: "Rahul Kumar",
                        department: "CSE",
                        date: "2024-01-15",
                        subject: "Data Structures",
                        sessionType: "Theory",
                        timeSlot: "10:00-11:00",
                        reason: "Forgot to mark attendance during class",
                        status: "pending",
                        submittedAt: new Date().toISOString(),
                        reviewedBy: null,
                        reviewedAt: null,
                        adminComments: ""
                    },
                    {
                        id: 2,
                        studentId: 2,
                        studentName: "Rahul Kumar",
                        department: "CSE",
                        date: "2024-01-14",
                        subject: "Computer Networks",
                        sessionType: "Practical",
                        timeSlot: "14:00-15:00",
                        reason: "Technical issue with attendance system",
                        status: "approved",
                        submittedAt: new Date(Date.now() - 86400000).toISOString(),
                        reviewedBy: "System Administrator",
                        reviewedAt: new Date().toISOString(),
                        adminComments: "Valid reason, approved"
                    }
                ];
                localStorage.setItem('attendanceRequests', JSON.stringify(attendanceRequests));
            }
            
            console.log('Sample data initialized:', { 
                users: users.length, 
                students: students.length, 
                attendanceRequests: attendanceRequests.length 
            });
        }

        // Attendance Management Functions
        function handleAttendanceSubmission(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                studentId: currentUser.id,
                studentName: currentUser.fullName,
                department: students.find(s => s.username === currentUser.username)?.department || 'Unknown',
                date: document.getElementById('attendanceDate').value,
                subject: document.getElementById('attendanceSubject').value,
                sessionType: document.getElementById('sessionType').value,
                timeSlot: document.getElementById('timeSlot').value,
                reason: document.getElementById('attendanceReason').value.trim(),
                status: 'pending',
                submittedAt: new Date().toISOString(),
                reviewedBy: null,
                reviewedAt: null,
                adminComments: ""
            };

            // Validation
            if (!validateAttendanceRequest(formData)) return;

            // Check if request already exists for same date and subject
            const existingRequest = attendanceRequests.find(req => 
                req.studentId === formData.studentId && 
                req.date === formData.date && 
                req.subject === formData.subject &&
                req.timeSlot === formData.timeSlot
            );

            if (existingRequest) {
                showMessage('You have already submitted a request for this date, subject, and time slot!', 'error');
                return;
            }

            attendanceRequests.push(formData);
            localStorage.setItem('attendanceRequests', JSON.stringify(attendanceRequests));
            
            showMessage('Attendance request submitted successfully! Waiting for admin approval.', 'success');
            document.getElementById('attendanceForm').reset();
            loadMyAttendanceRequests();
        }

        function validateAttendanceRequest(data) {
            const selectedDate = new Date(data.date);
            const today = new Date();
            const sevenDaysAgo = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));

            if (selectedDate > today) {
                showMessage('Cannot submit attendance for future dates!', 'error');
                return false;
            }

            if (selectedDate < sevenDaysAgo) {
                showMessage('Cannot submit attendance for dates older than 7 days!', 'error');
                return false;
            }

            if (!data.date || !data.subject || !data.sessionType || !data.timeSlot) {
                showMessage('Please fill all required fields!', 'error');
                return false;
            }

            if (!data.reason || data.reason.length < 10) {
                showMessage('Please provide a detailed reason (minimum 10 characters)!', 'error');
                return false;
            }

            return true;
        }

        function loadAttendanceManagement() {
            updateAttendanceStats();
            displayAttendanceRequests();
        }

        function updateAttendanceStats() {
            const today = new Date().toDateString();
            const pending = attendanceRequests.filter(req => req.status === 'pending').length;
            const approvedToday = attendanceRequests.filter(req => 
                req.status === 'approved' && 
                new Date(req.reviewedAt).toDateString() === today
            ).length;
            const rejectedToday = attendanceRequests.filter(req => 
                req.status === 'rejected' && 
                new Date(req.reviewedAt).toDateString() === today
            ).length;
            const total = attendanceRequests.length;

            document.getElementById('pendingRequests').textContent = pending;
            document.getElementById('approvedRequests').textContent = approvedToday;
            document.getElementById('rejectedRequests').textContent = rejectedToday;
            document.getElementById('totalRequests').textContent = total;
        }

        function displayAttendanceRequests() {
            const tbody = document.getElementById('attendanceRequestsTable');
            let filteredRequests = [...attendanceRequests];

            // Apply filters
            const statusFilter = document.getElementById('attendanceStatusFilter')?.value || 'all';
            const deptFilter = document.getElementById('attendanceDeptFilter')?.value || 'all';
            const fromDate = document.getElementById('attendanceFromDate')?.value;
            const toDate = document.getElementById('attendanceToDate')?.value;

            if (statusFilter !== 'all') {
                filteredRequests = filteredRequests.filter(req => req.status === statusFilter);
            }

            if (deptFilter !== 'all') {
                filteredRequests = filteredRequests.filter(req => req.department === deptFilter);
            }

            if (fromDate) {
                filteredRequests = filteredRequests.filter(req => req.date >= fromDate);
            }

            if (toDate) {
                filteredRequests = filteredRequests.filter(req => req.date <= toDate);
            }

            // Sort by submission date (newest first)
            filteredRequests.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt));

            const statusColors = {
                pending: 'bg-yellow-600',
                approved: 'bg-green-600',
                rejected: 'bg-red-600'
            };

            tbody.innerHTML = filteredRequests.map(request => `
                <tr class="border-b border-white/20 hover:bg-white/10 transition-colors">
                    <td class="p-3">
                        <div class="font-semibold">${request.studentName}</div>
                        <div class="text-sm text-gray-300">ID: ${request.studentId}</div>
                    </td>
                    <td class="p-3">${request.department}</td>
                    <td class="p-3">
                        <div>${request.date}</div>
                        <div class="text-sm text-gray-300">${request.timeSlot}</div>
                    </td>
                    <td class="p-3">
                        <div>${request.subject}</div>
                        <div class="text-sm text-gray-300">${request.sessionType}</div>
                    </td>
                    <td class="p-3">
                        <div class="max-w-xs truncate" title="${request.reason}">
                            ${request.reason}
                        </div>
                    </td>
                    <td class="p-3">
                        <span class="px-2 py-1 rounded text-white text-sm ${statusColors[request.status]}">
                            ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                        </span>
                        ${request.reviewedBy ? `<div class="text-xs text-gray-300 mt-1">By: ${request.reviewedBy}</div>` : ''}
                    </td>
                    <td class="p-3">
                        ${request.status === 'pending' ? `
                            <div class="flex space-x-2">
                                <button onclick="reviewAttendanceRequest(${request.id}, 'approved')" 
                                        class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="reviewAttendanceRequest(${request.id}, 'rejected')" 
                                        class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button onclick="showAttendanceDetails(${request.id})" 
                                        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        ` : `
                            <div class="flex space-x-2">
                                <button onclick="showAttendanceDetails(${request.id})" 
                                        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${request.status !== 'pending' ? `
                                    <button onclick="revertAttendanceRequest(${request.id})" 
                                            class="bg-orange-600 text-white px-3 py-1 rounded text-sm hover:bg-orange-700 transition-colors">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                ` : ''}
                            </div>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function reviewAttendanceRequest(requestId, action) {
            const request = attendanceRequests.find(req => req.id === requestId);
            if (!request) return;

            const comments = prompt(`Please provide comments for ${action} this request:`);
            if (comments === null) return; // User cancelled

            request.status = action;
            request.reviewedBy = currentUser.fullName;
            request.reviewedAt = new Date().toISOString();
            request.adminComments = comments || `Request ${action} by admin`;

            localStorage.setItem('attendanceRequests', JSON.stringify(attendanceRequests));
            
            showMessage(`Attendance request ${action} successfully!`, 'success');
            loadAttendanceManagement();
        }

        function revertAttendanceRequest(requestId) {
            if (!confirm('Are you sure you want to revert this request back to pending?')) return;

            const request = attendanceRequests.find(req => req.id === requestId);
            if (!request) return;

            request.status = 'pending';
            request.reviewedBy = null;
            request.reviewedAt = null;
            request.adminComments = '';

            localStorage.setItem('attendanceRequests', JSON.stringify(attendanceRequests));
            
            showMessage('Attendance request reverted to pending status!', 'success');
            loadAttendanceManagement();
        }

        function showAttendanceDetails(requestId) {
            const request = attendanceRequests.find(req => req.id === requestId);
            if (!request) return;

            const details = `
                Student: ${request.studentName} (${request.department})
                Date: ${request.date}
                Subject: ${request.subject}
                Session: ${request.sessionType}
                Time: ${request.timeSlot}
                Reason: ${request.reason}
                Status: ${request.status.toUpperCase()}
                Submitted: ${new Date(request.submittedAt).toLocaleString()}
                ${request.reviewedBy ? `Reviewed by: ${request.reviewedBy}` : ''}
                ${request.reviewedAt ? `Reviewed at: ${new Date(request.reviewedAt).toLocaleString()}` : ''}
                ${request.adminComments ? `Admin Comments: ${request.adminComments}` : ''}
            `;

            alert(details);
        }

        function filterAttendanceRequests() {
            displayAttendanceRequests();
        }

        function loadSubmitAttendance() {
            // Set max date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').max = today;
            
            // Set min date to 7 days ago
            const sevenDaysAgo = new Date(Date.now() - (7 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0];
            document.getElementById('attendanceDate').min = sevenDaysAgo;

            loadMyAttendanceRequests();
        }

        function loadMyAttendanceRequests() {
            if (currentUser.accountType !== 'student') return;

            const myRequests = attendanceRequests
                .filter(req => req.studentId === currentUser.id)
                .sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt))
                .slice(0, 5); // Show only last 5 requests

            const statusColors = {
                pending: 'bg-yellow-600',
                approved: 'bg-green-600',
                rejected: 'bg-red-600'
            };

            const statusIcons = {
                pending: 'fas fa-clock',
                approved: 'fas fa-check-circle',
                rejected: 'fas fa-times-circle'
            };

            const requestsHTML = myRequests.map(request => `
                <div class="glass-effect rounded-xl p-4 flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <i class="${statusIcons[request.status]} text-lg ${
                                request.status === 'pending' ? 'text-yellow-300' :
                                request.status === 'approved' ? 'text-green-300' : 'text-red-300'
                            }"></i>
                            <div>
                                <h4 class="text-white font-semibold">${request.subject}</h4>
                                <p class="text-gray-300 text-sm">${request.date} • ${request.timeSlot}</p>
                            </div>
                        </div>
                        <p class="text-gray-400 text-sm mb-2">${request.reason}</p>
                        <div class="flex items-center justify-between">
                            <span class="px-2 py-1 rounded text-white text-xs ${statusColors[request.status]}">
                                ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                            </span>
                            <span class="text-gray-400 text-xs">
                                ${new Date(request.submittedAt).toLocaleDateString()}
                            </span>
                        </div>
                        ${request.adminComments ? `
                            <div class="mt-2 p-2 bg-blue-600/20 rounded border border-blue-400/30">
                                <p class="text-blue-200 text-sm">
                                    <i class="fas fa-comment mr-1"></i>
                                    Admin: ${request.adminComments}
                                </p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('myAttendanceRequests').innerHTML = requestsHTML || 
                '<p class="text-gray-400 text-center py-4">No attendance requests found.</p>';
        }

        // Setup event listeners
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Wait for DOM to be fully loaded
            setTimeout(() => {
                // Login form
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    console.log('Login form found, adding listener');
                    loginForm.addEventListener('submit', handleLogin);
                    
                    // Also add click handler for mobile
                    const loginBtn = loginForm.querySelector('button[type="submit"]');
                    if (loginBtn) {
                        loginBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            handleLogin(e);
                        });
                    }
                } else {
                    console.log('Login form not found');
                }

                // Register form
                const registerForm = document.getElementById('registerForm');
                if (registerForm) {
                    console.log('Register form found, adding listener');
                    registerForm.addEventListener('submit', handleRegister);
                    
                    // Also add click handler for mobile
                    const registerBtn = registerForm.querySelector('button[type="submit"]');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            handleRegister(e);
                        });
                    }
                } else {
                    console.log('Register form not found');
                }

                // Student form
                const studentForm = document.getElementById('studentForm');
                if (studentForm) {
                    studentForm.addEventListener('submit', handleAddStudent);
                }

                // Attendance form
                const attendanceForm = document.getElementById('attendanceForm');
                if (attendanceForm) {
                    attendanceForm.addEventListener('submit', handleAttendanceSubmission);
                }
            }, 100);
        }

        // Authentication Functions
        function showAuthForm(formType) {
            console.log('Showing form:', formType);
            
            // Hide all forms
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('signinForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            
            // Show selected form
            if (formType === 'welcome') {
                document.getElementById('welcomeScreen').style.display = 'block';
            } else if (formType === 'signin') {
                document.getElementById('signinForm').style.display = 'block';
            } else if (formType === 'signup') {
                document.getElementById('signupForm').style.display = 'block';
            }
        }

        function toggleAccountFields() {
            const accountType = document.getElementById('accountType').value;
            const studentFields = document.getElementById('studentFields');
            const adminFields = document.getElementById('adminFields');
            
            if (accountType === 'student') {
                studentFields.style.display = 'block';
                adminFields.style.display = 'none';
            } else if (accountType === 'admin') {
                studentFields.style.display = 'none';
                adminFields.style.display = 'block';
            } else {
                studentFields.style.display = 'none';
                adminFields.style.display = 'none';
            }
        }

        function handleLogin(e) {
            if (e) e.preventDefault();
            console.log('Login form submitted');
            
            const usernameField = document.getElementById('loginId');
            const passwordField = document.getElementById('loginPassword');
            
            if (!usernameField || !passwordField) {
                console.error('Login form fields not found');
                showMessage('Login form error. Please refresh the page.', 'error');
                return;
            }
            
            const username = usernameField.value.trim().toLowerCase(); // Normalize for comparison
            const password = passwordField.value;
            
            console.log('Login attempt for username:', username);
            console.log('Available users:', users.map(u => ({ username: u.username, type: u.accountType })));
            
            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }
            
            // Find user in users array (case-insensitive username comparison)
            const user = users.find(u => u.username.toLowerCase() === username && u.password === password);
            console.log('User found:', user ? `Yes - ${user.accountType}` : 'No');
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                console.log('Login successful for:', user.fullName, 'Type:', user.accountType);
                
                // Show main app
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                // Update UI based on user role
                updateUserInterface();
                
                showMessage(`Welcome back, ${user.fullName}!`, 'success');
                
                // Clear form
                usernameField.value = '';
                passwordField.value = '';
            } else {
                console.log('Login failed - invalid credentials for username:', username);
                console.log('Checking all users for debug:', users.map(u => ({ 
                    stored: u.username.toLowerCase(), 
                    entered: username, 
                    match: u.username.toLowerCase() === username,
                    passwordMatch: u.password === password
                })));
                showMessage('Invalid username or password! Please check your credentials.', 'error');
            }
        }

        function handleRegister(e) {
            if (e) e.preventDefault();
            console.log('Register form submitted');
            
            // Get form elements with error checking
            const accountTypeField = document.getElementById('accountType');
            const fullNameField = document.getElementById('regFullName');
            const usernameField = document.getElementById('regNumber');
            const emailField = document.getElementById('regEmail');
            const phoneField = document.getElementById('regPhone');
            const passwordField = document.getElementById('regPassword');
            const confirmPasswordField = document.getElementById('regConfirmPassword');
            
            if (!accountTypeField || !fullNameField || !usernameField || !emailField || !passwordField || !confirmPasswordField) {
                console.error('Registration form fields not found');
                showMessage('Registration form error. Please refresh the page.', 'error');
                return;
            }
            
            const formData = {
                id: Date.now(),
                accountType: accountTypeField.value,
                fullName: fullNameField.value.trim(),
                username: usernameField.value.trim().toLowerCase(), // Normalize username
                email: emailField.value.trim().toLowerCase(), // Normalize email
                phone: phoneField ? phoneField.value.trim() : '',
                password: passwordField.value,
                confirmPassword: confirmPasswordField.value,
                dateCreated: new Date().toISOString()
            };

            console.log('Registration attempt for:', formData.username, 'Type:', formData.accountType);
            console.log('Current users in system:', users.map(u => ({ username: u.username, email: u.email })));

            // Add type-specific fields
            if (formData.accountType === 'student') {
                const deptField = document.getElementById('regDepartment');
                const yearField = document.getElementById('regYear');
                const semesterField = document.getElementById('regSemester');
                
                if (deptField && yearField && semesterField) {
                    formData.department = deptField.value;
                    formData.year = yearField.value;
                    formData.semester = semesterField.value;
                }
                console.log('Student fields:', { dept: formData.department, year: formData.year, semester: formData.semester });
            } else if (formData.accountType === 'admin') {
                const roleField = document.getElementById('regRole');
                if (roleField) {
                    formData.role = roleField.value;
                }
                console.log('Admin role:', formData.role);
            }

            // Validation
            if (!validateRegistration(formData)) return;

            // Check for duplicate username (case-insensitive)
            const existingUsername = users.find(u => u.username.toLowerCase() === formData.username.toLowerCase());
            if (existingUsername) {
                console.log('Username conflict found:', existingUsername.username);
                showMessage('Username already exists! Please choose a different username.', 'error');
                return;
            }

            // Check for duplicate email (case-insensitive)
            const existingEmail = users.find(u => u.email.toLowerCase() === formData.email.toLowerCase());
            if (existingEmail) {
                console.log('Email conflict found:', existingEmail.email);
                showMessage('Email already exists! Please use a different email address.', 'error');
                return;
            }

            console.log('No duplicates found, proceeding with registration...');

            // Remove confirm password before saving
            delete formData.confirmPassword;

            // Add user to users array
            users.push(formData);
            localStorage.setItem('users', JSON.stringify(users));
            console.log('User added to users array. Total users:', users.length);
            
            // If student, also add to students array
            if (formData.accountType === 'student') {
                const studentData = {
                    id: formData.id,
                    fullName: formData.fullName,
                    studentId: generateStudentId(formData.department, formData.year),
                    username: formData.username,
                    email: formData.email,
                    phone: formData.phone,
                    department: formData.department,
                    year: formData.year,
                    semester: formData.semester,
                    gpa: 0,
                    dateAdded: formData.dateCreated
                };
                students.push(studentData);
                localStorage.setItem('students', JSON.stringify(students));
                console.log('Student added to students array. Total students:', students.length);
                console.log('New student data:', studentData);
            }
            
            showMessage(`Account created successfully! Welcome ${formData.fullName}! You can now sign in with your credentials.`, 'success');
            showAuthForm('signin');
            
            // Clear form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.reset();
                // Also hide the conditional fields
                document.getElementById('studentFields').style.display = 'none';
                document.getElementById('adminFields').style.display = 'none';
            }
            
            console.log('Registration completed successfully for:', formData.username);
        }

        function validateRegistration(data) {
            console.log('Validating registration data:', data);
            
            if (!data.accountType) {
                showMessage('Please select an account type', 'error');
                return false;
            }
            
            if (!data.fullName || data.fullName.length < 2) {
                showMessage('Please enter a valid full name (minimum 2 characters)', 'error');
                return false;
            }
            
            if (!data.username || data.username.length < 3) {
                showMessage('Please enter a valid username (minimum 3 characters)', 'error');
                return false;
            }
            
            // Check username format (no spaces, special characters except underscore)
            if (!/^[a-zA-Z0-9_]+$/.test(data.username)) {
                showMessage('Username can only contain letters, numbers, and underscores', 'error');
                return false;
            }
            
            if (!data.email || !isValidEmail(data.email)) {
                showMessage('Please enter a valid email address', 'error');
                return false;
            }
            
            if (!data.password || data.password.length < 6) {
                showMessage('Password must be at least 6 characters long', 'error');
                return false;
            }
            
            if (data.password !== data.confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return false;
            }
            
            if (data.accountType === 'student') {
                if (!data.department || !data.year || !data.semester) {
                    showMessage('Please fill all required student fields (Department, Year, Semester)', 'error');
                    console.log('Student validation failed:', { dept: data.department, year: data.year, semester: data.semester });
                    return false;
                }
                console.log('Student validation passed');
            }
            
            if (data.accountType === 'admin') {
                if (!data.role) {
                    showMessage('Please select a role type for admin account', 'error');
                    return false;
                }
                console.log('Admin validation passed');
            }
            
            console.log('All validation checks passed');
            return true;
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function generateStudentId(department, year) {
            const deptCodes = {
                'CSE': 'CS',
                'EC': 'EC',
                'ME': 'ME',
                'CE': 'CE',
                'EE': 'EE'
            };
            
            const deptCode = deptCodes[department] || 'XX';
            const currentYear = new Date().getFullYear().toString().slice(-2);
            const serial = (students.length + 1).toString().padStart(3, '0');
            
            return `485${deptCode}${currentYear}${serial}`;
        }

        function updateUserInterface() {
            if (!currentUser) {
                console.error('No current user found');
                return;
            }
            
            console.log('Updating UI for user:', currentUser.fullName, 'Type:', currentUser.accountType);
            
            document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.fullName}!`;
            document.getElementById('userRole').textContent = currentUser.accountType === 'admin' ? 'Administrator' : 'Student';
            
            if (currentUser.accountType === 'admin') {
                console.log('Setting up admin interface');
                document.getElementById('adminNav').style.display = 'flex';
                document.getElementById('studentNav').style.display = 'none';
                showSection('dashboard');
                updateDashboard();
            } else if (currentUser.accountType === 'student') {
                console.log('Setting up student interface');
                document.getElementById('adminNav').style.display = 'none';
                document.getElementById('studentNav').style.display = 'flex';
                showSection('studentDashboard');
                updateStudentDashboard();
            } else {
                console.error('Unknown account type:', currentUser.accountType);
            }
        }

        function loadCurrentUser() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                updateUserInterface();
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            
            showAuthForm('welcome');
            showMessage('Logged out successfully!', 'success');
        }

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(section).style.display = 'block';
            currentSection = section;
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-opacity-100');
                btn.classList.add('bg-opacity-80');
            });
            
            if (section === 'dashboard') {
                updateDashboard();
                initializeCharts();
            } else if (section === 'viewStudents') {
                displayStudents();
            } else if (section === 'studentDashboard') {
                updateStudentDashboard();
            } else if (section === 'profile') {
                loadStudentProfile();
            } else if (section === 'analytics') {
                loadAnalytics();
            } else if (section === 'grades') {
                loadStudentGrades();
            } else if (section === 'attendance') {
                loadStudentAttendance();
            } else if (section === 'assignments') {
                loadStudentAssignments();
            } else if (section === 'notifications') {
                loadNotifications();
            } else if (section === 'attendanceManagement') {
                loadAttendanceManagement();
            } else if (section === 'submitAttendance') {
                loadSubmitAttendance();
            }
        }

        // Student Management
        function handleAddStudent(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                fullName: document.getElementById('fullName').value.trim(),
                studentId: document.getElementById('studentId').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                department: document.getElementById('department').value,
                year: document.getElementById('year').value,
                semester: document.getElementById('semester').value,
                gpa: 0,
                dateAdded: new Date().toISOString()
            };

            // Validation
            if (!formData.fullName || !formData.studentId || !formData.email || !formData.department || !formData.year) {
                showMessage('Please fill all required fields', 'error');
                return;
            }

            // Check for duplicate student ID
            if (students.some(s => s.studentId === formData.studentId)) {
                showMessage('Student ID already exists!', 'error');
                return;
            }

            students.push(formData);
            localStorage.setItem('students', JSON.stringify(students));
            
            showMessage('Student added successfully!', 'success');
            document.getElementById('studentForm').reset();
            updateDashboard();
        }

        function displayStudents() {
            const tbody = document.getElementById('studentsTable');
            
            tbody.innerHTML = students.map(student => `
                <tr class="border-b border-white/20 hover:bg-white/10 transition-colors">
                    <td class="p-3">${student.fullName}</td>
                    <td class="p-3">${student.studentId}</td>
                    <td class="p-3">${student.department}</td>
                    <td class="p-3">${student.year}</td>
                    <td class="p-3">
                        <button onclick="deleteStudent(${student.id})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                students = students.filter(s => s.id !== id);
                localStorage.setItem('students', JSON.stringify(students));
                displayStudents();
                updateDashboard();
                showMessage('Student deleted successfully', 'success');
            }
        }

        // Dashboard Updates
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = students.length;
            
            const avgGrade = students.length > 0 ? 
                (students.reduce((sum, s) => sum + s.gpa, 0) / students.length).toFixed(2) : '0.00';
            document.getElementById('avgGrade').textContent = avgGrade;
            
            const topPerformers = students.filter(s => s.gpa >= 3.5).length;
            document.getElementById('topPerformers').textContent = topPerformers;
            
            // Update recent activities
            updateRecentActivities();
        }

        function updateStudentDashboard() {
            if (currentUser.accountType !== 'student') {
                console.log('Not a student user, skipping student dashboard update');
                return;
            }
            
            console.log('Updating student dashboard for:', currentUser.username);
            console.log('Available students:', students.map(s => s.username));
            
            const student = students.find(s => s.username === currentUser.username);
            if (student) {
                console.log('Student found:', student);
                document.getElementById('dashboardWelcome').textContent = `Welcome back, ${student.fullName}!`;
                document.getElementById('dashboardStudentInfo').textContent = 
                    `${student.department} Department - Year ${student.year}, Semester ${student.semester} | Student ID: ${student.studentId}`;
            } else {
                console.log('Student not found in students array');
                // Fallback to user data
                document.getElementById('dashboardWelcome').textContent = `Welcome back, ${currentUser.fullName}!`;
                document.getElementById('dashboardStudentInfo').textContent = 
                    `${currentUser.department || 'Unknown'} Department - Year ${currentUser.year || 'N/A'}`;
            }
        }

        function loadStudentProfile() {
            if (currentUser.accountType !== 'student') return;
            
            const student = students.find(s => s.username === currentUser.username);
            if (!student) return;
            
            const profileHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-white font-semibold mb-2">Full Name</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.fullName}
                        </div>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Student ID</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.studentId}
                        </div>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Email</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.email}
                        </div>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Phone</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.phone || 'Not provided'}
                        </div>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Department</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.department}
                        </div>
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">Year</label>
                        <div class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                            ${student.year} Year
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('studentProfile').innerHTML = profileHTML;
        }

        // Message System
        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                info: 'bg-blue-600'
            };
            
            messageDiv.className = `${colors[type]} text-white px-6 py-3 rounded-lg mb-4 shadow-lg slide-in`;
            messageDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // PWA Functions
        function initializePWA() {
            // Generate PWA Manifest
            const manifest = {
                name: "Student-Hub - AI Student Management",
                short_name: "Student-Hub",
                description: "AI-powered student details management system",
                start_url: "/",
                display: "standalone",
                background_color: "#4F46E5",
                theme_color: "#4F46E5",
                orientation: "portrait",
                icons: [
                    {
                        src: "data:image/svg+xml;base64," + btoa(`
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="#4F46E5">
                                <path d="M320 96H192L144.6 24.9C137.5 14.2 145.1 0 157.9 0H354.1C366.9 0 374.5 14.2 367.4 24.9L320 96zM192 128H320C373 128 416 171 416 224V448C416 483.3 387.3 512 352 512H160C124.7 512 96 483.3 96 448V224C96 171 139 128 192 128z"/>
                            </svg>
                        `),
                        sizes: "512x512",
                        type: "image/svg+xml"
                    }
                ]
            };

            const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            document.getElementById('manifest-placeholder').href = manifestURL;

            // Show install popup
            setTimeout(() => {
                if (!isAppInstalled()) {
                    document.getElementById('installPopup').style.display = 'flex';
                    document.getElementById('floatingInstall').style.display = 'block';
                    document.getElementById('installBanner').style.display = 'block';
                }
            }, 2000);

            // Install button handlers
            document.getElementById('installBtn').addEventListener('click', handleInstall);
            document.getElementById('installPopupBtn').addEventListener('click', handleInstall);
            document.getElementById('dismissInstall').addEventListener('click', () => {
                document.getElementById('installBanner').style.display = 'none';
            });
            document.getElementById('dismissPopup').addEventListener('click', () => {
                document.getElementById('installPopup').style.display = 'none';
            });
        }

        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        function handleInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showMessage('Student-Hub installed successfully!', 'success');
                    }
                    deferredPrompt = null;
                });
            } else {
                showMessage('Installation not available. Try adding to home screen manually.', 'info');
            }
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        // Chart Initialization
        function initializeCharts() {
            setTimeout(() => {
                // Department Performance Chart
                const deptCtx = document.getElementById('departmentChart');
                if (deptCtx) {
                    new Chart(deptCtx, {
                        type: 'bar',
                        data: {
                            labels: ['CSE', 'EC', 'ME', 'CE', 'EE'],
                            datasets: [{
                                label: 'Average GPA',
                                data: [3.8, 3.6, 3.4, 3.7, 3.5],
                                backgroundColor: 'rgba(79, 70, 229, 0.8)',
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { labels: { color: 'white' } }
                            },
                            scales: {
                                y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                        }
                    });
                }

                // Grade Distribution Chart
                const gradeCtx = document.getElementById('gradeChart');
                if (gradeCtx) {
                    new Chart(gradeCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['A+', 'A', 'B+', 'B', 'C'],
                            datasets: [{
                                data: [25, 35, 20, 15, 5],
                                backgroundColor: [
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(245, 158, 11, 0.8)',
                                    'rgba(239, 68, 68, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { labels: { color: 'white' } }
                            }
                        }
                    });
                }
            }, 500);
        }

        // Analytics Functions
        function loadAnalytics() {
            // Load AI Predictions
            const predictions = [
                { title: 'Performance Trend', value: '↗️ Improving', color: 'text-green-300' },
                { title: 'Risk Students', value: '3 Students', color: 'text-red-300' },
                { title: 'Top Performers', value: '12 Students', color: 'text-blue-300' }
            ];

            const predictionsHTML = predictions.map(pred => `
                <div class="glass-effect rounded-xl p-4 text-center">
                    <h4 class="text-white font-semibold mb-2">${pred.title}</h4>
                    <div class="text-2xl font-bold ${pred.color}">${pred.value}</div>
                </div>
            `).join('');

            document.getElementById('aiPredictions').innerHTML = predictionsHTML;

            // Initialize analytics charts
            setTimeout(() => {
                const perfCtx = document.getElementById('performanceChart');
                if (perfCtx) {
                    new Chart(perfCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Average Performance',
                                data: [3.2, 3.4, 3.6, 3.5, 3.7, 3.8],
                                borderColor: 'rgba(34, 197, 94, 1)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: 'white' } } },
                            scales: {
                                y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                        }
                    });
                }

                const attCtx = document.getElementById('attendanceChart');
                if (attCtx) {
                    new Chart(attCtx, {
                        type: 'bar',
                        data: {
                            labels: ['CSE', 'EC', 'ME', 'CE', 'EE'],
                            datasets: [{
                                label: 'Attendance %',
                                data: [85, 82, 88, 86, 84],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: 'white' } } },
                            scales: {
                                y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                        }
                    });
                }
            }, 500);
        }

        // Report Generation
        function generateReport(type) {
            const reportOutput = document.getElementById('reportOutput');
            const reportContent = document.getElementById('reportContent');
            
            let content = '';
            
            if (type === 'student') {
                content = `
                    <h4 class="text-lg font-bold mb-4">Student Report - ${new Date().toLocaleDateString()}</h4>
                    <div class="space-y-2">
                        <p><strong>Total Students:</strong> ${students.length}</p>
                        <p><strong>Active Students:</strong> ${students.length}</p>
                        <p><strong>Departments:</strong> CSE, EC, ME, CE, EE</p>
                        <p><strong>Average GPA:</strong> 3.6</p>
                    </div>
                    <div class="mt-4">
                        <h5 class="font-bold mb-2">Department Breakdown:</h5>
                        <ul class="list-disc list-inside space-y-1">
                            <li>CSE: ${students.filter(s => s.department === 'CSE').length} students</li>
                            <li>EC: ${students.filter(s => s.department === 'EC').length} students</li>
                            <li>ME: ${students.filter(s => s.department === 'ME').length} students</li>
                            <li>CE: ${students.filter(s => s.department === 'CE').length} students</li>
                            <li>EE: ${students.filter(s => s.department === 'EE').length} students</li>
                        </ul>
                    </div>
                `;
            } else if (type === 'performance') {
                content = `
                    <h4 class="text-lg font-bold mb-4">Performance Report - ${new Date().toLocaleDateString()}</h4>
                    <div class="space-y-2">
                        <p><strong>Overall Performance:</strong> Good</p>
                        <p><strong>Top Performers:</strong> ${students.filter(s => s.gpa >= 3.5).length} students</p>
                        <p><strong>Average GPA:</strong> 3.6</p>
                        <p><strong>Improvement Rate:</strong> +12% from last semester</p>
                    </div>
                `;
            } else if (type === 'attendance') {
                content = `
                    <h4 class="text-lg font-bold mb-4">Attendance Report - ${new Date().toLocaleDateString()}</h4>
                    <div class="space-y-2">
                        <p><strong>Overall Attendance:</strong> 85%</p>
                        <p><strong>Best Department:</strong> ME (88%)</p>
                        <p><strong>Students with >90% attendance:</strong> 45</p>
                        <p><strong>Students with <75% attendance:</strong> 8</p>
                    </div>
                `;
            }
            
            reportContent.innerHTML = content;
            reportOutput.style.display = 'block';
            showMessage(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`, 'success');
        }

        // Student-specific functions
        function loadStudentGrades() {
            const grades = [
                { subject: 'Data Structures', credits: 4, grade: 'A', points: 4.0 },
                { subject: 'Computer Networks', credits: 3, grade: 'A-', points: 3.7 },
                { subject: 'Database Systems', credits: 4, grade: 'B+', points: 3.3 },
                { subject: 'Software Engineering', credits: 3, grade: 'A', points: 4.0 },
                { subject: 'Web Technologies', credits: 3, grade: 'A+', points: 4.0 }
            ];

            const gradesHTML = grades.map(grade => `
                <tr class="border-b border-white/20 hover:bg-white/10 transition-colors">
                    <td class="p-3">${grade.subject}</td>
                    <td class="p-3">${grade.credits}</td>
                    <td class="p-3"><span class="px-2 py-1 rounded bg-green-600 text-white">${grade.grade}</span></td>
                    <td class="p-3">${grade.points}</td>
                </tr>
            `).join('');

            document.getElementById('gradesTable').innerHTML = gradesHTML;
        }

        function loadStudentAttendance() {
            setTimeout(() => {
                const ctx = document.getElementById('subjectAttendanceChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Data Structures', 'Networks', 'Database', 'Software Eng', 'Web Tech'],
                            datasets: [{
                                label: 'Attendance %',
                                data: [88, 92, 85, 90, 87],
                                backgroundColor: [
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(245, 158, 11, 0.8)',
                                    'rgba(239, 68, 68, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: 'white' } } },
                            scales: {
                                y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                        }
                    });
                }
            }, 500);
        }

        function loadStudentAssignments() {
            const assignments = [
                { title: 'Database Design Project', subject: 'Database Systems', dueDate: '2024-01-15', status: 'pending', priority: 'high' },
                { title: 'Network Security Report', subject: 'Computer Networks', dueDate: '2024-01-20', status: 'completed', priority: 'medium' },
                { title: 'Web Application Development', subject: 'Web Technologies', dueDate: '2024-01-10', status: 'overdue', priority: 'high' },
                { title: 'Algorithm Analysis', subject: 'Data Structures', dueDate: '2024-01-25', status: 'pending', priority: 'low' }
            ];

            const assignmentsHTML = assignments.map(assignment => {
                const statusColors = {
                    pending: 'bg-yellow-600',
                    completed: 'bg-green-600',
                    overdue: 'bg-red-600'
                };

                const priorityColors = {
                    high: 'border-red-400',
                    medium: 'border-yellow-400',
                    low: 'border-green-400'
                };

                return `
                    <div class="glass-effect rounded-xl p-4 border-l-4 ${priorityColors[assignment.priority]}">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-white font-semibold">${assignment.title}</h4>
                            <span class="px-2 py-1 rounded text-white text-sm ${statusColors[assignment.status]}">
                                ${assignment.status.charAt(0).toUpperCase() + assignment.status.slice(1)}
                            </span>
                        </div>
                        <p class="text-gray-300 text-sm mb-1">${assignment.subject}</p>
                        <p class="text-gray-400 text-sm">Due: ${assignment.dueDate}</p>
                    </div>
                `;
            }).join('');

            document.getElementById('assignmentsList').innerHTML = assignmentsHTML;
        }

        function loadNotifications() {
            const notifications = [
                { title: 'Assignment Due Reminder', message: 'Database Design Project is due in 2 days', time: '2 hours ago', type: 'warning' },
                { title: 'Grade Updated', message: 'Your Computer Networks grade has been updated', time: '1 day ago', type: 'success' },
                { title: 'New Announcement', message: 'Mid-semester exam schedule released', time: '2 days ago', type: 'info' },
                { title: 'Attendance Alert', message: 'Your attendance in Web Technologies is below 75%', time: '3 days ago', type: 'error' }
            ];

            const typeColors = {
                warning: 'bg-yellow-600',
                success: 'bg-green-600',
                info: 'bg-blue-600',
                error: 'bg-red-600'
            };

            const typeIcons = {
                warning: 'fas fa-exclamation-triangle',
                success: 'fas fa-check-circle',
                info: 'fas fa-info-circle',
                error: 'fas fa-times-circle'
            };

            const notificationsHTML = notifications.map(notification => `
                <div class="glass-effect rounded-xl p-4 flex items-start space-x-4">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 ${typeColors[notification.type]} rounded-full flex items-center justify-center">
                            <i class="${typeIcons[notification.type]} text-white"></i>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-white font-semibold mb-1">${notification.title}</h4>
                        <p class="text-gray-300 text-sm mb-2">${notification.message}</p>
                        <p class="text-gray-400 text-xs">${notification.time}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('notificationsList').innerHTML = notificationsHTML;
        }

        // Update recent activities
        function updateRecentActivities() {
            const activities = [
                { action: 'New student registered', user: 'Priya Sharma', time: '5 minutes ago' },
                { action: 'Grade updated', user: 'Rahul Kumar', time: '15 minutes ago' },
                { action: 'Attendance marked', user: 'System', time: '1 hour ago' },
                { action: 'Report generated', user: 'Admin', time: '2 hours ago' }
            ];

            const activitiesHTML = activities.map(activity => `
                <div class="flex items-center justify-between p-3 bg-white/10 rounded-lg">
                    <div>
                        <p class="text-white font-medium">${activity.action}</p>
                        <p class="text-gray-300 text-sm">${activity.user}</p>
                    </div>
                    <span class="text-gray-400 text-sm">${activity.time}</span>
                </div>
            `).join('');

            const container = document.getElementById('recentActivities');
            if (container) {
                container.innerHTML = activitiesHTML;
            }
        }

        // Debug function to clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This will reset the app to initial state.')) {
                localStorage.clear();
                location.reload();
            }
        }

        console.log('Student-Hub loaded successfully!');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ae7e747234851f',t:'MTc1NzE2NzI0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
